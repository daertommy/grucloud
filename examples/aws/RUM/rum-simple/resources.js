// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "IdentityPool",
    group: "Cognito",
    properties: ({ config }) => ({
      AllowUnauthenticatedIdentities: true,
      IdentityPoolName: `RUM-Monitor-${
        config.region
      }-${config.accountId()}-8918708312761`,
    }),
  },
  {
    type: "IdentityPoolRolesAttachments",
    group: "Cognito",
    properties: ({ config, getId }) => ({
      Roles: {
        unauthenticated: `${getId({
          type: "Role",
          group: "IAM",
          name: `RUM-Monitor-${
            config.region
          }-${config.accountId()}-8918708312761-Unauth`,
        })}`,
      },
    }),
    dependencies: ({ config }) => ({
      identityPool: `RUM-Monitor-${
        config.region
      }-${config.accountId()}-8918708312761`,
      iamRoles: [
        `RUM-Monitor-${
          config.region
        }-${config.accountId()}-8918708312761-Unauth`,
      ],
    }),
  },
  {
    type: "Policy",
    group: "IAM",
    properties: ({ config }) => ({
      PolicyName: "RUMPutBatchMetrics-8918708312761",
      PolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Action: "rum:PutRumEvents",
            Resource: `arn:aws:rum:${
              config.region
            }:${config.accountId()}:appmonitor/my-monitor`,
          },
        ],
      },
      Path: "/",
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({ config, getId }) => ({
      RoleName: `RUM-Monitor-${
        config.region
      }-${config.accountId()}-8918708312761-Unauth`,
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Federated: "cognito-identity.amazonaws.com",
            },
            Action: "sts:AssumeRoleWithWebIdentity",
            Condition: {
              StringEquals: {
                "cognito-identity.amazonaws.com:aud": `${getId({
                  type: "IdentityPool",
                  group: "Cognito",
                  name: `RUM-Monitor-${
                    config.region
                  }-${config.accountId()}-8918708312761`,
                })}`,
              },
              "ForAnyValue:StringLike": {
                "cognito-identity.amazonaws.com:amr": "unauthenticated",
              },
            },
          },
        ],
      },
    }),
    dependencies: ({ config }) => ({
      policies: ["RUMPutBatchMetrics-8918708312761"],
      cognitoIdentityPools: [
        `RUM-Monitor-${config.region}-${config.accountId()}-8918708312761`,
      ],
    }),
  },
  {
    type: "AppMonitor",
    group: "RUM",
    properties: ({}) => ({
      Domain: "*.grucloud.org",
      Name: "my-monitor",
      Tags: {
        "my-monitor": "",
      },
      CwLogEnabled: true,
    }),
    dependencies: ({ config }) => ({
      identityPool: `RUM-Monitor-${
        config.region
      }-${config.accountId()}-8918708312761`,
    }),
  },
];
