// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "Budget",
    group: "Budgets",
    properties: ({ getId }) => ({
      Actions: [
        {
          ActionThreshold: {
            ActionThresholdType: "PERCENTAGE",
            ActionThresholdValue: 70,
          },
          ActionType: "RUN_SSM_DOCUMENTS",
          ApprovalModel: "AUTOMATIC",
          Definition: {
            SsmActionDefinition: {
              ActionSubType: "STOP_EC2_INSTANCES",
              InstanceIds: ["i-0751aea04276aadb8"],
              Region: "us-east-1",
            },
          },
          ExecutionRoleArn: `${getId({
            type: "Role",
            group: "IAM",
            name: "role-budget-ec2",
          })}`,
          NotificationType: "ACTUAL",
          Subscribers: [
            {
              Address: "fred@mail.com",
              SubscriptionType: "EMAIL",
            },
            {
              Address: `${getId({
                type: "Topic",
                group: "SNS",
                name: "topic-budget",
              })}`,
              SubscriptionType: "SNS",
            },
          ],
        },
      ],
      BudgetLimit: {
        Amount: "40.0",
        Unit: "USD",
      },
      BudgetName: "budget",
      BudgetType: "COST",
      CostTypes: {
        IncludeCredit: false,
        IncludeDiscount: true,
        IncludeOtherSubscription: true,
        IncludeRecurring: true,
        IncludeRefund: false,
        IncludeSubscription: true,
        IncludeSupport: true,
        IncludeTax: true,
        IncludeUpfront: true,
        UseAmortized: false,
        UseBlended: false,
      },
      Notifications: [
        {
          ComparisonOperator: "GREATER_THAN",
          NotificationType: "ACTUAL",
          Subscribers: [
            {
              Address: `${getId({
                type: "Topic",
                group: "SNS",
                name: "topic-budget",
              })}`,
              SubscriptionType: "SNS",
            },
            {
              Address: "fred@mail.com",
              SubscriptionType: "EMAIL",
            },
          ],
          Threshold: 70,
        },
      ],
      TimeUnit: "MONTHLY",
    }),
    dependencies: ({}) => ({
      iamRolesExecution: ["role-budget-ec2"],
      snsTopics: ["topic-budget"],
    }),
  },
  {
    type: "InstanceProfile",
    group: "IAM",
    name: "role-budget-ec2",
    dependencies: ({}) => ({
      roles: ["role-budget-ec2"],
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({}) => ({
      RoleName: "role-budget-ec2",
      Description: "Allows EC2 instances to call AWS services on your behalf.",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "budgets.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      AttachedPolicies: [
        {
          PolicyArn: "arn:aws:iam::aws:policy/AmazonEC2FullAccess",
          PolicyName: "AmazonEC2FullAccess",
        },
      ],
    }),
  },
  {
    type: "Topic",
    group: "SNS",
    name: "topic-budget",
    properties: ({ config }) => ({
      Attributes: {
        Policy: {
          Version: "2008-10-17",
          Id: "__default_policy_ID",
          Statement: [
            {
              Sid: "AWSBudgets-notification-1",
              Effect: "Allow",
              Principal: {
                Service: "budgets.amazonaws.com",
              },
              Action: "SNS:Publish",
              Resource: `arn:aws:sns:${
                config.region
              }:${config.accountId()}:topic-budget`,
            },
            {
              Sid: "__default_statement_ID",
              Effect: "Allow",
              Principal: {
                AWS: "*",
              },
              Action: [
                "SNS:GetTopicAttributes",
                "SNS:SetTopicAttributes",
                "SNS:AddPermission",
                "SNS:RemovePermission",
                "SNS:DeleteTopic",
                "SNS:Subscribe",
                "SNS:ListSubscriptionsByTopic",
                "SNS:Publish",
              ],
              Resource: `arn:aws:sns:${
                config.region
              }:${config.accountId()}:topic-budget`,
              Condition: {
                StringEquals: {
                  "AWS:SourceOwner": `${config.accountId()}`,
                },
              },
            },
          ],
        },
      },
    }),
  },
];
