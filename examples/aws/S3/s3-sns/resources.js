// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "Bucket",
    group: "S3",
    properties: ({ config }) => ({
      Name: "grucloud-s3-sns-test",
      ServerSideEncryptionConfiguration: {
        Rules: [
          {
            ApplyServerSideEncryptionByDefault: {
              SSEAlgorithm: "AES256",
            },
          },
        ],
      },
      NotificationConfiguration: {
        TopicConfigurations: [
          {
            TopicArn: `arn:aws:sns:${
              config.region
            }:${config.accountId()}:sam-app-SNSTopic-15XRP2Y8B6PO1`,
            Events: ["s3:ObjectCreated:*"],
          },
        ],
      },
    }),
    dependencies: ({}) => ({
      snsTopics: ["sam-app-SNSTopic-15XRP2Y8B6PO1"],
    }),
  },
  {
    type: "Topic",
    group: "SNS",
    name: "sam-app-SNSTopic-15XRP2Y8B6PO1",
    properties: ({ config }) => ({
      Attributes: {
        Policy: {
          Version: "2012-10-17",
          Statement: [
            {
              Effect: "Allow",
              Principal: {
                Service: "s3.amazonaws.com",
              },
              Action: "sns:Publish",
              Resource: `arn:aws:sns:${
                config.region
              }:${config.accountId()}:sam-app-SNSTopic-15XRP2Y8B6PO1`,
              Condition: {
                StringEquals: {
                  "aws:SourceAccount": `${config.accountId()}`,
                },
                ArnEquals: {
                  "aws:SourceArn": "arn:aws:s3:::grucloud-s3-sns-test",
                },
              },
            },
          ],
        },
        DeliveryPolicy: {
          http: {
            defaultRequestPolicy: {
              headerContentType: "text/plain; charset=UTF-8",
            },
          },
        },
      },
    }),
  },
];
