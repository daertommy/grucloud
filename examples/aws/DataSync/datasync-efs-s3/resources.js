// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "LogGroup",
    group: "CloudWatchLogs",
    properties: ({}) => ({
      logGroupName: "/aws/datasync",
    }),
  },
  {
    type: "LocationEfs",
    group: "DataSync",
    properties: ({}) => ({
      InTransitEncryption: "NONE",
    }),
    dependencies: ({}) => ({
      efsFileSystem: "my-fs",
      subnet: "vpc-default::subnet-default-a",
      securityGroups: ["sg::vpc-default::default"],
    }),
  },
  {
    type: "LocationS3",
    group: "DataSync",
    properties: ({}) => ({
      S3StorageClass: "STANDARD",
    }),
    dependencies: ({}) => ({
      iamRole: "AWSDataSyncS3BucketAccess-gc-datasync-destination",
      s3Bucket: "gc-datasync-destination",
    }),
  },
  {
    type: "Task",
    group: "DataSync",
    properties: ({}) => ({
      Name: "my-datasync-task",
      Options: {
        Gid: "INT_VALUE",
        LogLevel: "BASIC",
        PosixPermissions: "PRESERVE",
        PreserveNfsAcls: "NONE",
        Uid: "INT_VALUE",
      },
    }),
    dependencies: ({}) => ({
      logGroup: "/aws/datasync",
      destinationS3: "gc-datasync-destination",
      sourceEfs: "my-fs",
    }),
  },
  {
    type: "SecurityGroup",
    group: "EC2",
    name: "sg::vpc-default::default",
    isDefault: true,
    dependencies: ({}) => ({
      vpc: "vpc-default",
    }),
  },
  {
    type: "Subnet",
    group: "EC2",
    name: "subnet-default-a",
    isDefault: true,
    dependencies: ({}) => ({
      vpc: "vpc-default",
    }),
  },
  { type: "Vpc", group: "EC2", name: "vpc-default", isDefault: true },
  {
    type: "FileSystem",
    group: "EFS",
    name: "my-fs",
    properties: ({ config }) => ({
      AvailabilityZoneName: `${config.region}a`,
    }),
  },
  {
    type: "MountTarget",
    group: "EFS",
    properties: ({ config }) => ({
      AvailabilityZoneName: `${config.region}a`,
    }),
    dependencies: ({}) => ({
      fileSystem: "my-fs",
      subnet: "vpc-default::subnet-default-a",
      securityGroups: ["sg::vpc-default::default"],
    }),
  },
  {
    type: "Policy",
    group: "IAM",
    properties: ({}) => ({
      PolicyName: "AWSDataSyncS3BucketAccess-gc-datasync-destination",
      PolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Action: [
              "s3:GetBucketLocation",
              "s3:ListBucket",
              "s3:ListBucketMultipartUploads",
            ],
            Effect: "Allow",
            Resource: "arn:aws:s3:::gc-datasync-destination",
          },
          {
            Action: [
              "s3:AbortMultipartUpload",
              "s3:DeleteObject",
              "s3:GetObject",
              "s3:ListMultipartUploadParts",
              "s3:PutObjectTagging",
              "s3:GetObjectTagging",
              "s3:PutObject",
            ],
            Effect: "Allow",
            Resource: "arn:aws:s3:::gc-datasync-destination/*",
          },
        ],
      },
      Path: "/service-role/",
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({ config }) => ({
      RoleName: "AWSDataSyncS3BucketAccess-gc-datasync-destination",
      Path: "/service-role/",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "datasync.amazonaws.com",
            },
            Action: "sts:AssumeRole",
            Condition: {
              StringEquals: {
                "aws:SourceAccount": `${config.accountId()}`,
              },
              ArnLike: {
                "aws:SourceArn": `arn:aws:datasync:${
                  config.region
                }:${config.accountId()}:*`,
              },
            },
          },
        ],
      },
    }),
    dependencies: ({}) => ({
      policies: ["AWSDataSyncS3BucketAccess-gc-datasync-destination"],
    }),
  },
  {
    type: "Bucket",
    group: "S3",
    properties: ({}) => ({
      Name: "gc-datasync-destination",
      ServerSideEncryptionConfiguration: {
        Rules: [
          {
            ApplyServerSideEncryptionByDefault: {
              SSEAlgorithm: "AES256",
            },
            BucketKeyEnabled: true,
          },
        ],
      },
    }),
  },
];
