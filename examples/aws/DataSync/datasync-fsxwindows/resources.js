// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "LogGroup",
    group: "CloudWatchLogs",
    properties: ({}) => ({
      logGroupName: "/aws/datasync",
    }),
  },
  {
    type: "LocationFsxWindows",
    group: "DataSync",
    properties: ({}) => ({
      User: "myuser",
    }),
    dependencies: ({}) => ({
      fsxFileSystem: "fsx-windows",
      securityGroups: ["sg::vpc-default::fxs-windows"],
    }),
  },
  {
    type: "LocationS3",
    group: "DataSync",
    properties: ({}) => ({
      S3StorageClass: "STANDARD",
    }),
    dependencies: ({}) => ({
      iamRole: "AWSDataSyncS3BucketAccess-gc-datasync-fsx-windows",
      s3Bucket: "gc-datasync-fsx-windows",
    }),
  },
  {
    type: "Task",
    group: "DataSync",
    properties: ({}) => ({
      Name: "task-fsx-windows",
      Options: {
        LogLevel: "BASIC",
      },
    }),
    dependencies: ({}) => ({
      logGroup: "/aws/datasync",
      destinationS3: "gc-datasync-fsx-windows",
      sourceFsxWindows: "fsx-windows",
    }),
  },
  {
    type: "Directory",
    group: "DirectoryService",
    properties: ({}) => ({
      Edition: "Standard",
      Name: "corp.grucloud.org",
      ShortName: "corp",
      Size: "Small",
      Type: "MicrosoftAD",
      Password: process.env.CORP_GRUCLOUD_ORG_PASSWORD,
    }),
    dependencies: ({}) => ({
      subnets: [
        "vpc-default::subnet-default-b",
        "vpc-default::subnet-default-d",
      ],
    }),
  },
  { type: "Vpc", group: "EC2", name: "vpc-default", isDefault: true },
  {
    type: "Subnet",
    group: "EC2",
    name: "subnet-default-b",
    isDefault: true,
    dependencies: ({}) => ({
      vpc: "vpc-default",
    }),
  },
  {
    type: "Subnet",
    group: "EC2",
    name: "subnet-default-d",
    isDefault: true,
    dependencies: ({}) => ({
      vpc: "vpc-default",
    }),
  },
  {
    type: "SecurityGroup",
    group: "EC2",
    properties: ({}) => ({
      GroupName: "fxs-windows",
      Description: "Fsx Windows",
    }),
    dependencies: ({}) => ({
      vpc: "vpc-default",
    }),
  },
  // {
  //   type: "SecurityGroup",
  //   group: "EC2",
  //   name: "sg::vpc-default::d-9067a739b3_controllers",
  //   readOnly: true,
  //   properties: ({}) => ({
  //     GroupName: "d-9067a739b3_controllers",
  //     Description:
  //       "AWS created security group for d-9067a739b3 directory controllers",
  //   }),
  //   dependencies: ({}) => ({
  //     vpc: "vpc-default",
  //   }),
  // },
  {
    type: "FileSystem",
    group: "FSx",
    name: "fsx-windows",
    properties: ({}) => ({
      FileSystemType: "WINDOWS",
      StorageCapacity: 32,
      StorageType: "SSD",
      WindowsConfiguration: {
        AuditLogConfiguration: {
          FileAccessAuditLogLevel: "DISABLED",
          FileShareAccessAuditLogLevel: "DISABLED",
        },
        AutomaticBackupRetentionDays: 7,
        CopyTagsToBackups: false,
        DailyAutomaticBackupStartTime: "05:30",
        DeploymentType: "SINGLE_AZ_2",
        ThroughputCapacity: 32,
        WeeklyMaintenanceStartTime: "7:07:00",
      },
    }),
    dependencies: ({}) => ({
      directory: "corp.grucloud.org",
      securityGroups: ["sg::vpc-default::fxs-windows"],
      subnets: ["vpc-default::subnet-default-d"],
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({ config }) => ({
      RoleName: "AWSDataSyncS3BucketAccess-gc-datasync-fsx-windows",
      Path: "/service-role/",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "datasync.amazonaws.com",
            },
            Action: "sts:AssumeRole",
            Condition: {
              StringEquals: {
                "aws:SourceAccount": `${config.accountId()}`,
              },
              ArnLike: {
                "aws:SourceArn": `arn:aws:datasync:${
                  config.region
                }:${config.accountId()}:*`,
              },
            },
          },
        ],
      },
    }),
    dependencies: ({}) => ({
      policies: ["AWSDataSyncS3BucketAccess-gc-datasync-fsx-windows"],
    }),
  },
  {
    type: "Policy",
    group: "IAM",
    properties: ({}) => ({
      PolicyName: "AWSDataSyncS3BucketAccess-gc-datasync-fsx-windows",
      PolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Action: [
              "s3:GetBucketLocation",
              "s3:ListBucket",
              "s3:ListBucketMultipartUploads",
            ],
            Effect: "Allow",
            Resource: "arn:aws:s3:::gc-datasync-fsx-windows",
          },
          {
            Action: [
              "s3:AbortMultipartUpload",
              "s3:DeleteObject",
              "s3:GetObject",
              "s3:ListMultipartUploadParts",
              "s3:PutObjectTagging",
              "s3:GetObjectTagging",
              "s3:PutObject",
            ],
            Effect: "Allow",
            Resource: "arn:aws:s3:::gc-datasync-fsx-windows/*",
          },
        ],
      },
      Path: "/service-role/",
    }),
  },
  {
    type: "Bucket",
    group: "S3",
    properties: ({}) => ({
      Name: "gc-datasync-fsx-windows",
      ServerSideEncryptionConfiguration: {
        Rules: [
          {
            ApplyServerSideEncryptionByDefault: {
              SSEAlgorithm: "AES256",
            },
            BucketKeyEnabled: true,
          },
        ],
      },
    }),
  },
];
