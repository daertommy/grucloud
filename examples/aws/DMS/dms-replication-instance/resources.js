// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "Endpoint",
    group: "DMS",
    properties: ({}) => ({
      EndpointIdentifier: "endpoint-s3",
      EndpointType: "source",
      EngineDisplayName: "Amazon S3",
      EngineName: "s3",
      ExternalTableDefinition: '{"key":"a"}',
      S3Settings: {
        AddColumnName: true,
        BucketFolder: "csv",
        BucketName: "gc-dms-s3",
        CsvDelimiter: ",",
        CsvRowDelimiter: "\\n",
        EnableStatistics: true,
        ExternalTableDefinition: '{"key":"a"}',
      },
    }),
    dependencies: ({}) => ({
      iamRoleServiceAccess: "role-s3-rw",
    }),
  },
  {
    type: "Endpoint",
    group: "DMS",
    properties: ({}) => ({
      EndpointIdentifier: "endpount-s3-target",
      EndpointType: "target",
      EngineDisplayName: "Amazon S3",
      EngineName: "s3",
      S3Settings: {
        BucketFolder: "csv",
        BucketName: "gc-dms-s3-target",
        CompressionType: "NONE",
        CsvDelimiter: ",",
        CsvRowDelimiter: "\\n",
        DatePartitionEnabled: false,
        EnableStatistics: true,
      },
    }),
    dependencies: ({}) => ({
      iamRoleServiceAccess: "role-s3-rw",
    }),
  },
  {
    type: "ReplicationInstance",
    group: "DMS",
    properties: ({}) => ({
      AllocatedStorage: 5,
      AutoMinorVersionUpgrade: true,
      AvailabilityZone: "us-east-1a",
      EngineVersion: "3.4.7",
      MultiAZ: false,
      NetworkType: "IPV4",
      PreferredMaintenanceWindow: "sat:08:19-sat:08:49",
      PubliclyAccessible: false,
      ReplicationInstanceClass: "dms.t3.micro",
      ReplicationInstanceIdentifier: "replication-instance",
    }),
    dependencies: ({}) => ({
      subnetGroup: "my-subnet-group",
      securityGroups: ["sg::vpc::default"],
    }),
  },
  {
    type: "ReplicationSubnetGroup",
    group: "DMS",
    properties: ({}) => ({
      ReplicationSubnetGroupDescription: "Subnet Group",
      ReplicationSubnetGroupIdentifier: "my-subnet-group",
      SupportedNetworkTypes: ["IPV4"],
    }),
    dependencies: ({ config }) => ({
      subnets: [
        `vpc::subnet-private1-${config.region}a`,
        `vpc::subnet-private2-${config.region}b`,
      ],
    }),
  },
  {
    type: "ReplicationTask",
    group: "DMS",
    properties: ({}) => ({
      MigrationType: "full-load",
      ReplicationTaskIdentifier: "task",
      ReplicationTaskSettings: {
        ChangeProcessingDdlHandlingPolicy: {
          HandleSourceTableAltered: true,
          HandleSourceTableDropped: true,
          HandleSourceTableTruncated: true,
        },
        ChangeProcessingTuning: {
          BatchApplyMemoryLimit: 500,
          BatchApplyPreserveTransaction: true,
          BatchApplyTimeoutMax: 30,
          BatchApplyTimeoutMin: 1,
          BatchSplitSize: 0,
          CommitTimeout: 1,
          MemoryKeepTime: 60,
          MemoryLimitTotal: 1024,
          MinTransactionSize: 1000,
          StatementCacheSize: 50,
        },
        ControlTablesSettings: {
          ControlSchema: "",
          FullLoadExceptionTableEnabled: false,
          HistoryTableEnabled: false,
          historyTimeslotInMinutes: 5,
          HistoryTimeslotInMinutes: 5,
          StatusTableEnabled: false,
          SuspendedTablesTableEnabled: false,
        },
        ErrorBehavior: {
          ApplyErrorDeletePolicy: "IGNORE_RECORD",
          ApplyErrorEscalationCount: 0,
          ApplyErrorEscalationPolicy: "LOG_ERROR",
          ApplyErrorFailOnTruncationDdl: false,
          ApplyErrorInsertPolicy: "LOG_ERROR",
          ApplyErrorUpdatePolicy: "LOG_ERROR",
          DataErrorEscalationCount: 0,
          DataErrorEscalationPolicy: "SUSPEND_TABLE",
          DataErrorPolicy: "LOG_ERROR",
          DataTruncationErrorPolicy: "LOG_ERROR",
          EventErrorPolicy: "IGNORE",
          FailOnNoTablesCaptured: true,
          FailOnTransactionConsistencyBreached: false,
          FullLoadIgnoreConflicts: true,
          RecoverableErrorCount: -1,
          RecoverableErrorInterval: 5,
          RecoverableErrorStopRetryAfterThrottlingMax: true,
          RecoverableErrorThrottling: true,
          RecoverableErrorThrottlingMax: 1800,
          TableErrorEscalationCount: 0,
          TableErrorEscalationPolicy: "STOP_TASK",
          TableErrorPolicy: "SUSPEND_TABLE",
        },
        FailTaskWhenCleanTaskResourceFailed: false,
        FullLoadSettings: {
          CommitRate: 10000,
          CreatePkAfterFullLoad: false,
          MaxFullLoadSubTasks: 8,
          StopTaskCachedChangesApplied: false,
          StopTaskCachedChangesNotApplied: false,
          TargetTablePrepMode: "DROP_AND_CREATE",
          TransactionConsistencyTimeout: 600,
        },
        Logging: {
          EnableLogContext: false,
          EnableLogging: false,
          LogComponents: [
            {
              Id: "TRANSFORMATION",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "SOURCE_UNLOAD",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "IO",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "TARGET_LOAD",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "PERFORMANCE",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "SOURCE_CAPTURE",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "SORTER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "REST_SERVER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "VALIDATOR_EXT",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "TARGET_APPLY",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "TASK_MANAGER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "TABLES_MANAGER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "METADATA_MANAGER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "FILE_FACTORY",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "COMMON",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "ADDONS",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "DATA_STRUCTURE",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "COMMUNICATION",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
            {
              Id: "FILE_TRANSFER",
              Severity: "LOGGER_SEVERITY_DEFAULT",
            },
          ],
        },
        StreamBufferSettings: {
          CtrlStreamBufferSizeInMB: 5,
          StreamBufferCount: 3,
          StreamBufferSizeInMB: 8,
        },
        TargetMetadata: {
          BatchApplyEnabled: false,
          FullLobMode: false,
          InlineLobMaxSize: 0,
          LimitedSizeLobMode: true,
          LoadMaxFileSize: 0,
          LobChunkSize: 0,
          LobMaxSize: 32,
          ParallelApplyBufferSize: 0,
          ParallelApplyQueuesPerThread: 0,
          ParallelApplyThreads: 0,
          ParallelLoadBufferSize: 0,
          ParallelLoadQueuesPerThread: 0,
          ParallelLoadThreads: 0,
          SupportLobs: true,
          TargetSchema: "",
          TaskRecoveryTableEnabled: false,
        },
      },
      TableMappings: {
        rules: [
          {
            filters: [],
            "object-locator": {
              "schema-name": "%",
              "table-name": "%",
            },
            "rule-action": "include",
            "rule-id": "512474359",
            "rule-name": "512474359",
            "rule-type": "selection",
          },
        ],
      },
    }),
    dependencies: ({}) => ({
      replicationInstance: "replication-instance",
      sourceEndpoint: "endpoint-s3",
      destinationEndpoint: "endpount-s3-target",
    }),
  },
  {
    type: "RouteTable",
    group: "EC2",
    name: ({ config }) => `rtb-private1-${config.region}a`,
    dependencies: ({}) => ({
      vpc: "vpc",
    }),
  },
  {
    type: "RouteTable",
    group: "EC2",
    name: ({ config }) => `rtb-private2-${config.region}b`,
    dependencies: ({}) => ({
      vpc: "vpc",
    }),
  },
  {
    type: "RouteTableAssociation",
    group: "EC2",
    dependencies: ({ config }) => ({
      routeTable: `vpc::rtb-private1-${config.region}a`,
      subnet: `vpc::subnet-private1-${config.region}a`,
    }),
  },
  {
    type: "RouteTableAssociation",
    group: "EC2",
    dependencies: ({ config }) => ({
      routeTable: `vpc::rtb-private2-${config.region}b`,
      subnet: `vpc::subnet-private2-${config.region}b`,
    }),
  },
  {
    type: "SecurityGroup",
    group: "EC2",
    name: "sg::vpc::default",
    isDefault: true,
    dependencies: ({}) => ({
      vpc: "vpc",
    }),
  },
  {
    type: "Subnet",
    group: "EC2",
    name: ({ config }) => `subnet-private1-${config.region}a`,
    properties: ({ config }) => ({
      AvailabilityZone: `${config.region}a`,
      NewBits: 4,
      NetworkNumber: 8,
    }),
    dependencies: ({}) => ({
      vpc: "vpc",
    }),
  },
  {
    type: "Subnet",
    group: "EC2",
    name: ({ config }) => `subnet-private2-${config.region}b`,
    properties: ({ config }) => ({
      AvailabilityZone: `${config.region}b`,
      NewBits: 4,
      NetworkNumber: 9,
    }),
    dependencies: ({}) => ({
      vpc: "vpc",
    }),
  },
  {
    type: "Vpc",
    group: "EC2",
    name: "vpc",
    properties: ({}) => ({
      CidrBlock: "10.0.0.0/16",
      DnsHostnames: true,
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({}) => ({
      RoleName: "dms-vpc-role",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Sid: "",
            Effect: "Allow",
            Principal: {
              Service: "dms.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      AttachedPolicies: [
        {
          PolicyArn:
            "arn:aws:iam::aws:policy/service-role/AmazonDMSVPCManagementRole",
          PolicyName: "AmazonDMSVPCManagementRole",
        },
      ],
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({}) => ({
      RoleName: "role-s3-rw",
      Description:
        "Allows Database Migration Service to call AWS services on your behalf.",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Sid: "",
            Effect: "Allow",
            Principal: {
              Service: "dms.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      AttachedPolicies: [
        {
          PolicyArn: "arn:aws:iam::aws:policy/AmazonS3FullAccess",
          PolicyName: "AmazonS3FullAccess",
        },
      ],
    }),
  },
];
