// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "DataSource",
    group: "AppSync",
    properties: ({ config }) => ({
      name: "events",
      type: "HTTP",
      httpConfig: {
        authorizationConfig: {
          authorizationType: "AWS_IAM",
          awsIamConfig: {
            signingRegion: `${config.region}`,
            signingServiceName: "events",
          },
        },
        endpoint: `https://events.${config.region}.amazonaws.com/`,
      },
    }),
    dependencies: ({}) => ({
      graphqlApi: "AppSyncEventBridgeAPI",
      serviceRole:
        "AppsyncEventbridgeStack-ApieventsServiceRole531FB6-1OV5AQSZ4CWBK",
    }),
  },
  {
    type: "GraphqlApi",
    group: "AppSync",
    properties: ({}) => ({
      name: "AppSyncEventBridgeAPI",
      authenticationType: "API_KEY",
      xrayEnabled: true,
      logConfig: {
        excludeVerboseContent: false,
        fieldLogLevel: "ALL",
      },
      apiKeys: [{}],
      schemaFile: "AppSyncEventBridgeAPI.graphql",
    }),
    dependencies: ({}) => ({
      cloudWatchLogsRole:
        "AppsyncEventbridgeStack-ApiApiLogsRole90293F72-7E0RPUK5AGTI",
    }),
  },
  {
    type: "Resolver",
    group: "AppSync",
    properties: ({}) => ({
      fieldName: "putEvent",
      kind: "UNIT",
      requestMappingTemplate: `{
  "version": "2018-05-29",
  "method": "POST",
  "resourcePath": "/",
  "params": {
    "headers": {
      "content-type": "application/x-amz-json-1.1",
      "x-amz-target":"AWSEvents.PutEvents"
    },
    "body": {
      "Entries":[
        {
          "Source":"appsync",
          "EventBusName": "AppSyncEventBus",
          "Detail":"{ "event": "$ctx.arguments.event"}",
          "DetailType":"Event Bridge via GraphQL"
         }
      ]
    }
  }
}
`,
      responseMappingTemplate: `## Raise a GraphQL field error in case of a datasource invocation error
#if($ctx.error)
  $util.error($ctx.error.message, $ctx.error.type)
#end
## if the response status code is not 200, then return an error. Else return the body **
#if($ctx.result.statusCode == 200)
    ## If response is 200, return the body.
	$ctx.result.body
#else
    ## If response is not 200, append the response to error block.
    $utils.appendError($ctx.result.body, $ctx.result.statusCode)
#end
`,
      typeName: "Mutation",
    }),
    dependencies: ({}) => ({
      dataSource: "events",
      graphqlApi: "AppSyncEventBridgeAPI",
    }),
  },
  {
    type: "EventBus",
    group: "CloudWatchEvents",
    properties: ({}) => ({
      Name: "AppSyncEventBus",
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({}) => ({
      RoleName: "AppsyncEventbridgeStack-ApiApiLogsRole90293F72-7E0RPUK5AGTI",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "appsync.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      AttachedPolicies: [
        {
          PolicyName: "AWSAppSyncPushToCloudWatchLogs",
          PolicyArn:
            "arn:aws:iam::aws:policy/service-role/AWSAppSyncPushToCloudWatchLogs",
        },
      ],
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({ config }) => ({
      RoleName:
        "AppsyncEventbridgeStack-ApieventsServiceRole531FB6-1OV5AQSZ4CWBK",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "appsync.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      Policies: [
        {
          PolicyDocument: {
            Version: "2012-10-17",
            Statement: [
              {
                Action: "events:PutEvents",
                Resource: `arn:aws:events:${
                  config.region
                }:${config.accountId()}:event-bus/AppSyncEventBus`,
                Effect: "Allow",
              },
            ],
          },
          PolicyName: "ApieventsServiceRoleDefaultPolicyE6AB81C4",
        },
      ],
    }),
    dependencies: ({}) => ({
      eventBus: "AppSyncEventBus",
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({}) => ({
      RoleName:
        "AppsyncEventbridgeStack-AppSyncEventBridgeRoleE2F3-1A2KOXUYDW21",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "appsync.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      Policies: [
        {
          PolicyDocument: {
            Version: "2012-10-17",
            Statement: [
              {
                Action: "events:PutEvents",
                Resource: "*",
                Effect: "Allow",
              },
            ],
          },
          PolicyName: "AppSyncEventBridgeRoleDefaultPolicyC796B118",
        },
      ],
    }),
  },
];
