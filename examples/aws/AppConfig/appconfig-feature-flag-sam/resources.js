// Generated by 'gc gencode'
const {} = require("rubico");
const {} = require("rubico/x");

exports.createResources = () => [
  {
    type: "Api",
    group: "ApiGatewayV2",
    properties: ({}) => ({
      Name: "sam-app",
      Tags: {
        "httpapi:createdBy": "SAM",
      },
    }),
  },
  {
    type: "Deployment",
    group: "ApiGatewayV2",
    properties: ({}) => ({
      Description:
        "Automatic deployment triggered by changes to the Api configuration",
      AutoDeployed: true,
    }),
    dependencies: ({}) => ({
      api: "sam-app",
      stage: "sam-app::$default",
    }),
  },
  {
    type: "Integration",
    group: "ApiGatewayV2",
    properties: ({}) => ({
      ConnectionType: "INTERNET",
      IntegrationMethod: "POST",
      IntegrationType: "AWS_PROXY",
      PayloadFormatVersion: "2.0",
    }),
    dependencies: ({}) => ({
      api: "sam-app",
      lambdaFunction: "sam-app-SAMConfigFunction-QTjGGM76Kd6u",
    }),
  },
  {
    type: "Route",
    group: "ApiGatewayV2",
    properties: ({}) => ({
      RouteKey: "GET /config",
    }),
    dependencies: ({}) => ({
      api: "sam-app",
      integration:
        "integration::sam-app::sam-app-SAMConfigFunction-QTjGGM76Kd6u",
    }),
  },
  {
    type: "Stage",
    group: "ApiGatewayV2",
    properties: ({}) => ({
      AutoDeploy: true,
      StageName: "$default",
      Tags: {
        "httpapi:createdBy": "SAM",
      },
    }),
    dependencies: ({}) => ({
      api: "sam-app",
    }),
  },
  {
    type: "Application",
    group: "AppConfig",
    properties: ({}) => ({
      Name: "appconfig-feature-flag-sam",
    }),
  },
  {
    type: "ConfigurationProfile",
    group: "AppConfig",
    properties: ({}) => ({
      LocationUri: "hosted",
      Name: "TestConfig",
      Type: "AWS.AppConfig.FeatureFlags",
    }),
    dependencies: ({}) => ({
      application: "appconfig-feature-flag-sam",
    }),
  },
  {
    type: "Deployment",
    group: "AppConfig",
    dependencies: ({}) => ({
      configurationProfile: "appconfig-feature-flag-sam::TestConfig",
      deploymentStrategy: "SAMConfigDeploymentStrategy",
      environment: "appconfig-feature-flag-sam::dev",
      hostedConfigurationVersion: "appconfig-feature-flag-sam::TestConfig",
    }),
  },
  {
    type: "DeploymentStrategy",
    group: "AppConfig",
    properties: ({}) => ({
      DeploymentDurationInMinutes: 0,
      Description: "A deployment strategy to deploy the config immediately",
      FinalBakeTimeInMinutes: 0,
      GrowthFactor: 100,
      GrowthType: "LINEAR",
      Name: "SAMConfigDeploymentStrategy",
      ReplicateTo: "NONE",
    }),
  },
  {
    type: "Environment",
    group: "AppConfig",
    properties: ({}) => ({
      Name: "dev",
    }),
    dependencies: ({}) => ({
      application: "appconfig-feature-flag-sam",
    }),
  },
  {
    type: "HostedConfigurationVersion",
    group: "AppConfig",
    properties: ({}) => ({
      Description: "A sample hosted configuration version",
      ContentType: "application/json",
      Content: {
        flags: {
          pagination: {
            attributes: {
              pageSize: {
                constraints: {
                  maximum: 10,
                  minimum: 5,
                  required: false,
                  type: "number",
                },
              },
            },
            name: "AppPagination",
          },
          wizardSwitch: {
            name: "WizardSwitch",
          },
        },
        values: {
          pagination: {
            enabled: true,
            pageSize: 5,
          },
          wizardSwitch: {
            enabled: true,
          },
        },
        version: "1",
      },
    }),
    dependencies: ({}) => ({
      configurationProfile: "appconfig-feature-flag-sam::TestConfig",
    }),
  },
  {
    type: "Role",
    group: "IAM",
    properties: ({ config }) => ({
      RoleName: "sam-app-SAMConfigFunctionRole-1NSH6HM6R15FV",
      AssumeRolePolicyDocument: {
        Version: "2012-10-17",
        Statement: [
          {
            Effect: "Allow",
            Principal: {
              Service: "lambda.amazonaws.com",
            },
            Action: "sts:AssumeRole",
          },
        ],
      },
      Policies: [
        {
          PolicyDocument: {
            Version: "2012-10-17",
            Statement: [
              {
                Action: [
                  "appconfig:GetLatestConfiguration",
                  "appconfig:StartConfigurationSession",
                ],
                Resource: `arn:aws:appconfig:${
                  config.region
                }:${config.accountId()}:application/gq3hg0m/environment/7zfgjp7/configuration/agh57cq`,
                Effect: "Allow",
              },
            ],
          },
          PolicyName: "SAMConfigFunctionRolePolicy0",
        },
      ],
      AttachedPolicies: [
        {
          PolicyName: "AWSLambdaBasicExecutionRole",
          PolicyArn:
            "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
        },
      ],
      Tags: [
        {
          Key: "lambda:createdBy",
          Value: "SAM",
        },
      ],
    }),
  },
  {
    type: "Function",
    group: "Lambda",
    properties: ({ config, getId }) => ({
      Configuration: {
        Environment: {
          Variables: {
            SAM_CONFIG_PATH:
              "/applications/appconfig-feature-flag-sam/environments/dev/configurations/TestConfig",
          },
        },
        FunctionName: "sam-app-SAMConfigFunction-QTjGGM76Kd6u",
        Handler: "app.lambdaHandler",
        Runtime: "nodejs16.x",
      },
      Tags: {
        "lambda:createdBy": "SAM",
      },
      Policy: {
        Version: "2012-10-17",
        Id: "default",
        Statement: [
          {
            Sid: "sam-app-SAMConfigFunctionApiEventPermission-1TZKPUAZRC876",
            Effect: "Allow",
            Principal: {
              Service: "apigateway.amazonaws.com",
            },
            Action: "lambda:InvokeFunction",
            Resource: `arn:aws:lambda:${
              config.region
            }:${config.accountId()}:function:sam-app-SAMConfigFunction-QTjGGM76Kd6u`,
            Condition: {
              ArnLike: {
                "AWS:SourceArn": `${getId({
                  type: "Api",
                  group: "ApiGatewayV2",
                  name: "sam-app",
                })}/*/GET/config`,
              },
            },
          },
        ],
      },
    }),
    dependencies: ({}) => ({
      role: "sam-app-SAMConfigFunctionRole-1NSH6HM6R15FV",
    }),
  },
];
